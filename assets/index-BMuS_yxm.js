import{j as e,r,M as A,c as G}from"./vendor-react-CcpBEl17.js";import{w as D,x as K,y as T}from"./vendor-math-markdown-Bf5c9hq-.js";import{O as H}from"./vendor-CIf9bjjY.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function m(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=m(a);fetch(a.href,o)}})();const V=({models:n,selectedModel:i,onSelect:m})=>e.jsxs("div",{className:"selector-container",children:[e.jsx("label",{htmlFor:"model-select",children:"Model:"}),e.jsx("select",{id:"model-select",value:i,onChange:s=>m(s.target.value),disabled:n.length===0,children:n.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))})]}),_=({prompts:n,selectedPrompt:i,onSelect:m})=>e.jsxs("div",{className:"selector-container",children:[e.jsx("label",{htmlFor:"prompt-select",children:"Prompt:"}),e.jsxs("select",{id:"prompt-select",value:i,onChange:s=>m(s.target.value),children:[e.jsx("option",{value:"",children:"(None)"}),n.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),z=({messages:n})=>{const i=r.useRef(null);r.useEffect(()=>{var s;(s=i.current)==null||s.scrollIntoView({behavior:"auto"})},[n]);const m=s=>s&&s.replace(/\\\[/g,"$$$$").replace(/\\\]/g,"$$$$").replace(/\\\(/g,"$").replace(/\\\)/g,"$");return e.jsxs("div",{className:"message-list",children:[n.filter(s=>s.role!=="system").map((s,a)=>{const o=/<think>([\s\S]*?)?(?:<\/think>|$)/i,h=s.content.match(o);let l=s.thinking||null,x=s.content;!l&&h&&(l=h[1]?h[1].trim():"",x=s.content.replace(o,"").trim());const v=m(l),d=m(x);return e.jsx("div",{className:`message ${s.role}`,children:e.jsxs("div",{className:"message-content",children:[s.imagePreview&&e.jsx("img",{src:s.imagePreview,alt:"Uploaded",className:"chat-image"}),l&&e.jsxs("div",{className:"thinking",children:[e.jsxs("div",{className:"thinking-header",children:[e.jsx("span",{children:"ðŸ’­"})," Thinking Process"]}),e.jsx(A,{remarkPlugins:[K,T],rehypePlugins:[D],children:v})]}),e.jsx(A,{remarkPlugins:[K,T],rehypePlugins:[D],children:d})]})},a)}),e.jsx("div",{ref:i})]})},J="https://berkeley.babeltimeus.com",Q=()=>{const[n,i]=r.useState(null),[m,s]=r.useState([]);r.useEffect(()=>{const l=new H({host:J});i(l)},[]);const a=r.useCallback(async()=>{if(!n)return[];try{return(await n.list()).models||[]}catch(l){return console.error("Failed to list models:",l),[]}},[n]),o=r.useCallback(async(l,x,v)=>{if(n)try{const d=l.startsWith("gpt-oss")||l.startsWith("qwen")||l.startsWith("deepseek"),k=await n.chat({model:l,messages:x,stream:!0,...d?{think:!0}:{}});for await(const y of k)v(y)}catch(d){d.name!=="AbortError"&&console.error("Chat error:",d)}},[n]),h=r.useCallback(()=>{n&&n.abort()},[n]);return{ollama:n,listModels:a,chat:o,abort:h}},X=()=>{const{ollama:n,listModels:i,chat:m,abort:s}=Q(),[a,o]=r.useState([]),[h,l]=r.useState(""),[x,v]=r.useState([]),[d,k]=r.useState(""),[y,f]=r.useState([]),[C,N]=r.useState(""),[b,w]=r.useState(!1),[E,F]=r.useState(null),[P,O]=r.useState(null),S=r.useRef(null);r.useEffect(()=>{if(!n)return;(async()=>{const c=await i();o(c),c.length>0&&l(u=>c.find(j=>j.name===u)?u:c[0].name)})()},[n,i]),r.useEffect(()=>{fetch("/experiment-ai/prompts.json").then(t=>t.json()).then(t=>v(t)).catch(t=>console.error("Failed to load prompts list",t))},[]),r.useEffect(()=>{d?fetch(`/experiment-ai/prompts/${d}.txt`).then(t=>t.text()).then(t=>{f([{role:"system",content:t}])}).catch(t=>console.error(`Failed to load prompt ${d}`,t)):f([])},[d]);const U=t=>new Promise((c,u)=>{const p=new FileReader;p.readAsDataURL(t),p.onload=()=>{c(p.result)},p.onerror=j=>{u(j)}}),W=async t=>{const c=t.target.files[0];if(c){F(c);try{const u=await U(c);O(u)}catch(u){console.error("Error reading file:",u)}}},R=()=>{F(null),O(null),S.current&&(S.current.value="")},L=async()=>{const t=C.trim();if(t==="/abort"&&b){I("/abort");return}if(!t&&!E||b)return;const c=E,u=P;if(N(""),R(),w(!0),t.startsWith("/")){await I(t),w(!1);return}const p={role:"user",content:t};if(c&&u){const g=u.split(",")[1];p.images=[g],p.imagePreview=u}const j=[...y,p];f(j);let M={role:"assistant",content:"",thinking:""};f(g=>[...g,M]),await m(h,j,g=>{M.content+=g.message.content,g.message.thinking&&(M.thinking+=g.message.thinking),f(B=>{const $=[...B];return $[$.length-1]={...M},$})}),w(!1)},I=async t=>{if(t==="/abort")s(),w(!1),N("");else if(t==="/clear"){if(f([]),d){const c=await fetch(`/experiment-ai/prompts/${d}.txt`).then(u=>u.text());f([{role:"system",content:c}])}}else f(c=>[...c,{role:"system",content:`Unknown command: ${t}`}])},q=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),L())};return e.jsxs("div",{className:"chat-container",children:[e.jsxs("div",{className:"controls",children:[e.jsx(V,{models:a,selectedModel:h,onSelect:l}),e.jsx(_,{prompts:x,selectedPrompt:d,onSelect:k})]}),e.jsx(z,{messages:y}),e.jsxs("div",{className:"input-area-container",children:[P&&e.jsxs("div",{className:"image-preview",children:[e.jsx("img",{src:P,alt:"Upload preview"}),e.jsx("button",{className:"remove-image-btn",onClick:R,title:"Remove image",children:"Ã—"})]}),e.jsxs("div",{className:"input-area",children:[e.jsx("input",{type:"file",ref:S,onChange:W,accept:"image/*",style:{display:"none"}}),e.jsx("button",{className:"upload-btn",onClick:()=>{var t;return(t=S.current)==null?void 0:t.click()},title:"Upload Image",children:"ðŸ“·"}),e.jsx("textarea",{value:C,onChange:t=>N(t.target.value),onKeyDown:q,placeholder:"Type a message or upload an image...",rows:3}),e.jsx("button",{onClick:L,disabled:b||!h,children:b?"Sending...":"Send"})]})]})]})};function Y(){return e.jsxs("div",{className:"app-container",children:[e.jsx("header",{children:e.jsx("h1",{children:"Sam's Chatbot"})}),e.jsx(X,{})]})}G(document.getElementById("root")).render(e.jsx(r.StrictMode,{children:e.jsx(Y,{})}));
